<!DOCTYPE html>
<html xmlns:width="http://www.w3.org/1999/xhtml" xmlns:white-space="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">

    <script src="https://cdn.staticfile.org/jquery/2.1.1/jquery.min.js"></script>

    <link rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/4.1.0/css/bootstrap.min.css">
    <script src="https://cdn.staticfile.org/twitter-bootstrap/4.1.0/js/bootstrap.min.js"></script>

    <!-- 引入vue.js -->
    <script src="https://cdn.jsdelivr.net/npm/vue@2.6.10/dist/vue.js"></script>
    <script type="text/javascript" src="http://vuejs.org/js/vue.min.js"></script>

    <!-- 引入element -->
    <script src="//unpkg.com/element-ui@2.11.0/lib/index.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-chalk/index.css">
    <!-- 引入vue-resource -->
    <script src="//cdn.bootcss.com/vue-resource/1.0.3/vue-resource.js" type="text/javascript" charset="utf-8"></script>
    <style lang="scss">
        .el-tooltip__popper {
            max-width: 40%
        }
        .el-menu-vertical-demo:not(.el-menu--collapse) {
            width: 200px;
            min-height: 400px;
        }
        .el-popover {
            background: rgb(177, 176, 176) !important;
        }
        span {
            overflow: hidden;
            text-overflow: ellipsis;
            -o-text-overflow: ellipsis;
            white-space: nowrap;
            margin-left: 2px;
            padding: 2px;
        }
        .popover {
            position: absolute;
            top: 0;
            left: 0;
            margin-top: 1px;
            z-index: 1060;
            display: block;
            max-width: 276px;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
            font-style: normal;
            font-weight: 500;
            line-height: 2.4;
            text-align: center;
            text-align: start;
            text-decoration: none;
            text-shadow: none;
            text-transform: none;
            letter-spacing: normal;
            word-break: normal;
            word-spacing: normal;
            white-space: normal;
            line-break: auto;
            font-size: .875rem;
            word-wrap: break-word;
            background-color: #fff;
            background-clip: padding-box;
        }

    </style>
    <title>时光序接口测试管理</title>
</head>
<body style="background-color: #b4c1c1">
<div id="app" style="margin: 0">
    <el-menu
            :default-active="activeIndex2"
            class="el-menu-demo"
            mode="horizontal"
            @select="handleSelect"
            background-color="#545c64"
            text-color="#fff"
            active-text-color="#ffd04b">
        <el-menu-item index="1" style="color: #21aeff;font-weight: bold;font-size: 18px">时光序测试平台</el-menu-item>
        <el-menu-item index="1">首页</el-menu-item>
        <el-submenu index="2">
            <template slot="title">测试用例管</template>
            <el-menu-item index="2-1">Android测试用例</el-menu-item>
            <el-menu-item index="2-2">IOS测试用例</el-menu-item>
            <el-menu-item index="2-3">web端测试用例</el-menu-item>
        </el-submenu>
        <el-menu-item index="3"><a href="/index">接口自动化管理</a></el-menu-item>
        <el-menu-item index="5">测试计划管理</el-menu-item>
        <el-menu-item index="6">缺陷统计</el-menu-item>
        <el-menu-item index="7">测试报告</el-menu-item>
        <el-menu-item index="8"><a href="/sqlIndex">SqL操作</a></el-menu-item>
        <el-menu-item index="9">Redis操作</el-menu-item>
        <el-menu-item index="10">测试资源</el-menu-item>
        <el-menu-item index="11">测试技术分享</el-menu-item>
        <button type="button" class="btn btn-danger" style="line-height: 2.8;position: absolute;right: 1px;">退出登陆
        </button>
    </el-menu>
    <div style="margin: 0 20px 0 20px;padding: 1px">
        <el-button size="small" type="primary" @click="dialogFormVisible = true" style="margin: 10px">+添加接口测试流
        </el-button >
        <template>
            <el-select size="small" v-model="filtrate" @change="filtrateCreater" placeholder="筛选负责人">
                <el-option
                        v-for="item in creater"
                        :key="item.creater"
                        :label="item.creater"
                        :value="item.creater">
                </el-option>
            </el-select>
        </template>
        <div>
            <template>
                <el-table
                        v-loading="actionLoading"
                        element-loading-text="测试流接口运行中,请稍后"
                        id="flowTable"
                        ref="flowTableRef"
                        :data="flowData"
                        :header-cell-style="{background:'#836FFF',color:'#F0FFFF',padding:'3px'}"
                        border
                        height="800px"
                        stripe
                        size="mini"
                        highlight-current-row="true"
                        row-style="height:20px"
                        cell-style="padding:4px"
                        style="width:auto"
                        @expand-change="expandChange"
                        @cell-dblclick="dbEditFlowTable">
                    <el-table-column label="测试流 ID" size="small" prop="pk" id="flowId" width="90px">
                        <template slot-scope="scope">
                            <el-input style="display: none;margin: 0;padding: 0" :placeholder="scope.row.pk"
                                      v-model="scope.row.pk"></el-input>
                            <span class="span" style="display: block;font-weight: bold;color: #3557ff">
                                {%verbatim%}
                                {{scope.row.pk}}
                                {%endverbatim%}
                            </span>
                        </template>
                    </el-table-column>
                    <el-table-column label="测试流名称" prop="flow_name" id="flowName">
                        <template slot-scope="scope">
                            <el-input size="mini" style="display: none;margin: 0;padding: 0"
                                      :placeholder="scope.row.flow_name"
                                      v-model="scope.row.flow_name"></el-input>
                            <span class="span" style="display: block;font-weight: bold;">
                                {%verbatim%}
                                {{scope.row.flow_name}}
                                {%endverbatim%}
                            </span>
                        </template>
                    </el-table-column>
                    <el-table-column label="测试账号" prop="account" id="account">
                        <template slot-scope="scope">
                            <el-input size="mini" style="display: none;margin: 0;padding: 0"
                                      :placeholder="scope.row.account"
                                      v-model="scope.row.account"></el-input>
                            <span class="span" style="display: block">
                                {%verbatim%}
                                {{scope.row.account}}
                                {%endverbatim%}
                            </span>
                        </template>
                    </el-table-column>
                    <el-table-column label="测试账号密码" prop="password" id="password">
                        <template slot-scope="scope">
                            <el-input size="mini" style="display: none;margin: 0;padding: 0"
                                      :placeholder="scope.row.password"
                                      v-model="scope.row.password"></el-input>
                            <span class="span" style="display: block">
                                {%verbatim%}
                                {{scope.row.password}}
                                {%endverbatim%}
                            </span>
                        </template>
                    </el-table-column>
                    <el-table-column label="优先级" prop="priority" width="125px" id="priority">
                        <template slot-scope="scope">
                            <el-input size="mini" style="display: none;margin: 0;padding: 0"
                                      :placeholder="scope.row.priority"
                                      v-model="scope.row.priority"></el-input>
                            <span class="span" style="display: block">
                        {%verbatim%}
                        {{scope.row.priority}}
                        {%endverbatim%}
                    </span>
                        </template>
                    </el-table-column>
                    <el-table-column label="状态" prop="state" width="180px" id="state">
                        <template slot-scope="scope">
                            <el-input size="mini" style="display: none;margin: 0;padding: 0"
                                      :placeholder="scope.row.state"
                                      v-model="scope.row.state"></el-input>
                            <span class="span" style="display: block">
                            {%verbatim%}
                            {{formatState(scope.row)}}
                            {%endverbatim%}
                        </span>
                        </template>
                    </el-table-column>
                    <el-table-column label="负责人" prop="creater" width="120px" id="creater">
                        <template slot-scope="scope">
                            <el-input size="mini" style="display: none;margin: 0;padding: 0"
                                      :placeholder="scope.row.creater"
                                      v-model="scope.row.creater"></el-input>
                            <span class="span" style="display: block">
                            {%verbatim%}
                            {{scope.row.creater}}
                            {%endverbatim%}
                        </span>
                        </template>
                    </el-table-column>
                    <el-table-column label="操作" width="250px" prop="operation">
                        <template slot-scope="scope">
                            <el-button size="mini" type="success" style="margin: 2px;padding: 5px"
                                       @click.native.prevent="addFlowRow(flowData,scope.$index, scope.row)">添加
                            </el-button>
                            <el-button size="mini" type="danger" style="margin: 2px;padding: 5px"
                                       @click="deleteFlowRow(scope.$index,flowData)">删除
                            </el-button>
                            <el-dialog
                                    title="删除测试流"
                                    center="true"
                                    :visible.sync="deleteFlowDialogVisible"
                                    width="35%">
                                <span style="color: coral">确定删除当前测试流吗？删除后将不可恢复</span>
                                <span slot="footer" class="dialog-footer">
                                     <el-button @click="deleteFlowDialogVisible = false">取 消</el-button>
                                     <el-button type="primary" @click="deleteFlowOk(scope.$index,scope.row,flowData)">确定删除</el-button>
                                </span>
                            </el-dialog>
                            <el-button size="mini" class="save"
                                       style="display: none;margin: 2px;padding: 5px;float: left"
                                       type="warning"
                                       @click="saveFlowEdit(scope.$index, scope.row)">保存
                            </el-button>
                            <el-button size="mini" class="edit" type="primary"
                                       style="margin: 2px;padding: 5px;float: left"
                                       @click="editFlowTable(scope.$index, scope.row)">编辑
                            </el-button>
                            <el-button size="mini" class="save"
                                       style="display: block;margin: 2px;padding: 5px;float: left"
                                       type="warning"
                                       @click="actionFlow(scope.$index, scope.row)">运行
                            </el-button>

                        </template>
                    </el-table-column>
                    <el-table-column type="expand" width="140px" label="展开详情">
                        <template slot-scope="props">
                            <div style="background-color: #5cffa2">
                                <el-button size="mini" type="primary" @click="dialogTableVisible = true"
                                           style="float: left;margin: 5px">
                                    +添加接口
                                </el-button>
                                <el-table
                                        ref="nodeTable"
                                        id="nodeTable"
                                        class="nodeTable"
                                        :data="nodeData"
                                        stripe
                                        height="550px"
                                        size="mini"
                                        @row-click="rowClick"
                                        @cell-dblclick="dbEditNodeTable"
                                        highlight-current-row="true"
                                        :header-cell-style="{background:'#606266',color:'#FFFFFF',padding:0}"
                                        cell-style="padding:2px,font-size: 10px">
                                    <el-table-column label="步骤" width="80px"
                                                     sortable="true"
                                                     prop="order_id">
                                        <template slot-scope="scope">
                                            <el-input size="mini" style="display: none"
                                                      :placeholder="scope.row.order_id"
                                                      v-model="scope.row.order_id"></el-input>
                                            <span class="span" style="display: block;font-weight: bold">
                                        {%verbatim%}
                                            {{scope.row.order_id}}
                                        {%endverbatim%}
                                    </span>
                                        </template>
                                    </el-table-column>
                                    <el-table-column label="接口名称" width="220px" show-overflow-tooltip prop="node_name">
                                        <template slot-scope="scope">
                                            <el-input size="mini" style="display: none"
                                                      :placeholder="scope.row.node_name"
                                                      v-model="scope.row.node_name"></el-input>
                                            <span class="span" style="display: block;font-weight: bold;">
                                        {%verbatim%}
                                            {{scope.row.node_name}}
                                        {%endverbatim%}
                                    </span>
                                        </template>
                                    </el-table-column>
                                    <el-table-column label="请求方式" width="100px" show-overflow-tooltip
                                                     prop="method">
                                        <template slot-scope="scope">
                                            <el-input size="mini" style="display: none" :placeholder="scope.row.method"
                                                      v-model="scope.row.method"></el-input>
                                            <span class="span" style="display: block">
                                        {%verbatim%}
                                            {{scope.row.method}}
                                        {%endverbatim%}
                                    </span>
                                        </template>
                                    </el-table-column>
                                    <el-table-column label="接口路径" show-overflow-tooltip
                                                     prop="path">
                                        <template slot-scope="scope">
                                            <el-input size="mini" style="display: none" :placeholder="scope.row.path"
                                                      v-model="scope.row.path"></el-input>
                                            <span class="span" style="display: block;font-weight: bold;">
                                        {%verbatim%}
                                            {{scope.row.path}}
                                        {%endverbatim%}
                                    </span>
                                        </template>
                                    </el-table-column>
                                    <el-table-column label="请求参数" width="180px" show-overflow-tooltip prop="parameter"
                                                     style="padding: 0">
                                        <template slot-scope="scope">
                                            <el-input size="mini" style="display: none"
                                                      :placeholder="scope.row.parameter"
                                                      v-model="scope.row.parameter"></el-input>
                                            <el-popover
                                                    style="max-width:170px"
                                                    class="popover"
                                                    width="600px"
                                                    placement="left"
                                                    trigger="click">
                                                <p style="margin: 10px;font-weight: bold;color: #2140ff">接口请求参数配置</p>
                                                <el-input class="el-input-parameter" type="textarea"
                                                          :autosize="{ minRows: 5, maxRows: 20}"
                                                          style="display: block;width: 600px"
                                                          :placeholder="scope.row.parameter"
                                                          v-model="scope.row.parameter"></el-input>
                                                <el-button class="formatButton" type="primary"
                                                           style="float: right;margin: 10px"
                                                           @click="formatJson(scope.row,scope.$index)">格式化JSON
                                                </el-button>
                                                <el-button type="primary" style="float: right;margin: 10px"
                                                           @click="saveParameter(parameterData,scope.row)">保存修改
                                                </el-button>
                                                <el-button type="info" style="float: right;margin: 10px"
                                                           @click="pCancel()">
                                                    取消
                                                </el-button>
                                                <span class="parameterSpan"
                                                      style="color: chocolate"
                                                      slot="reference"
                                                      @click="getParameter(scope.$index, scope.row,scope.$event)">
                                                {%verbatim%}
                                                {{scope.row.parameter}}
                                                {%endverbatim%}
                                            </span>
                                            </el-popover>
                                        </template>
                                    </el-table-column>
                                    <el-table-column label="请求参数变量" show-overflow-tooltip prop="pre_keys">
                                        <template slot-scope="scope">
                                            <el-input size="mini" style="display: none"
                                                      :placeholder="scope.row.pre_keys"
                                                      v-model="scope.row.pre_keys"></el-input>
                                            <span class="span" style="display: block">
                                        {%verbatim%}
                                            {{scope.row.pre_keys}}
                                        {%endverbatim%}
                                    </span>
                                        </template>
                                    </el-table-column>
                                    <el-table-column label="等待时间" width="80px" show-overflow-tooltip prop="sleep_time"
                                                     style="padding: 0">
                                        <template slot-scope="scope">
                                            <el-input size="mini" style="display: none"
                                                      :placeholder="scope.row.sleep_time"
                                                      v-model="scope.row.sleep_time"></el-input>
                                            <span class="span" style="display: block">
                                        {%verbatim%}
                                            {{scope.row.sleep_time}}
                                        {%endverbatim%}
                                    </span>
                                        </template>
                                    </el-table-column>
                                    <el-table-column label="期望结果" show-overflow-tooltip prop="expect_response">
                                        <template slot-scope="scope">
                                            <el-input size="mini" style="display: none"
                                                      :placeholder="scope.row.expect_response"
                                                      v-model="scope.row.expect_response"></el-input>
                                            <span class="span" style="display: block">
                                                {%verbatim%}
                                                    {{scope.row.expect_response}}
                                                {%endverbatim%}
                                            </span>
                                        </template>
                                    </el-table-column>
                                    <el-table-column label="接口状态" prop="state" width="100px" id="state">
                                        <template slot-scope="scope">
                                            <el-input size="mini" style="display: none;margin: 0;padding: 0"
                                                      :placeholder="scope.row.state"
                                                      v-model="scope.row.state"></el-input>
                                            <span class="span" style="display: block">
                                                {%verbatim%}
                                                {{formatState(scope.row)}}
                                                {%endverbatim%}
                                            </span>
                                        </template>
                                    </el-table-column>
                                    <el-table-column label="前置sql" width="140px" class="preSqlbutton"
                                                     style="padding-bottom: 5px;"
                                                     show-overflow-tooltip
                                                     prop="preSql">
                                        <template slot-scope="scope">
                                            <el-popover
                                                    class="popover"
                                                    border="0"
                                                    placement="left"
                                                    width="800px"
                                                    trigger="click">
                                                <p style="margin: 10px;font-weight: bold;color: #2140ff">前置SQL查询信息配置</p>
                                                <p style="font-weight: bold;">
                                                <p></p>
                                                <el-tag style="float:left;margin: 3px;font-weight: bold" size="medium">
                                                    前置SQL查询开关
                                                </el-tag>
                                                <p></p>
                                                <el-select size="mini" v-model="preSqlData.isexcute_pre_sql"
                                                           style="margin: 1px;width: 750px"
                                                           placeholder="请选择是否开启前置SQL查询">
                                                    <el-option label="开启前置SQl查询" value=1></el-option>
                                                    <el-option label="关闭前置SQl查询" value=0></el-option>
                                                </el-select>
                                                </p>
                                                <p style="font-weight: bold;">
                                                    <el-tag style="float:left;margin: 3px" size="medium">前置SQL查询语句
                                                    </el-tag>
                                                    <el-input class="el-input-parameter" type="textarea"
                                                              :autosize="{ minRows: 3, maxRows: 20}"
                                                              style="display: block;width: 750px"
                                                              :placeholder="preSqlData.pre_sql_str"
                                                              v-model="preSqlData.pre_sql_str">
                                                    </el-input>
                                                </p>
                                                <p style="font-weight: bold;">
                                                    <el-tag style="float:left;margin: 3px" size="medium">前置SQL的变量参数
                                                    </el-tag>
                                                    <el-input class="el-input-parameter" type="textarea"
                                                              :autosize="{ minRows: 2, maxRows: 20}"
                                                              style="display: block;width: 750px"
                                                              :placeholder="preSqlData.pre_sql_para"
                                                              v-model="preSqlData.pre_sql_para">
                                                    </el-input>
                                                </p>
                                                <p style="font-weight: bold;">
                                                    <el-tag style="float:left;margin: 1px" size="medium">前置SQl查询结果接收变量
                                                    </el-tag>
                                                    <el-input class="el-input-parameter" type="textarea"
                                                              :autosize="{ minRows: 2, maxRows: 20}"
                                                              style="display: block;width: 750px"
                                                              :placeholder="preSqlData.pre_sql_out"
                                                              v-model="preSqlData.pre_sql_out">
                                                    </el-input>
                                                </p>
                                                <el-button type="primary" style="float: right;margin: 10px"
                                                           @click="savePreSql(preSqlData,scope.row)">保存修改
                                                </el-button>
                                                <el-button type="info" style="float: right;margin: 10px"
                                                           @click="pCancel()">
                                                    取消
                                                </el-button>
                                                <span
                                                        style="color: chocolate"
                                                        class="popoverButtonPre"
                                                        slot="reference"
                                                        @click="getPreSql(scope.$index, scope.row,scope.$event)">
                                                    {%verbatim%}
                                                    {{formatPreSql(scope.row,preSqlData)}}
                                                    {%endverbatim%}
                                                </span>
                                            </el-popover>
                                        </template>
                                    </el-table-column>
                                    <el-table-column label="后置sql" width="110px" show-overflow-tooltip
                                                     prop="outSqlData">
                                        <template slot-scope="scope">
                                            <el-popover
                                                    class="popover"
                                                    border="0"
                                                    placement="left"
                                                    width="800px"
                                                    trigger="click">
                                                <p style="margin: 10px;font-weight: bold;color: #2140ff">后置SQL校验信息配置</p>
                                                <p style="font-weight: bold;">
                                                <p></p>
                                                <el-tag style="float:left;margin: 3px;font-weight: bold" size="medium">
                                                    后置SQL校验开关
                                                </el-tag>
                                                <p></p>
                                                <el-select size="mini" v-model="outSqlData.ischechdb"
                                                           style="margin: 1px;width: 750px"
                                                           placeholder="请选择是否开启后置SQL校验">
                                                    <el-option label="开启后置SQL校验" value=1></el-option>
                                                    <el-option label="关闭后置SQL校验" value=0></el-option>
                                                </el-select>
                                                </p>
                                                <p style="font-weight: bold;">
                                                    <el-tag style="float:left;margin: 3px" size="medium">后置SQL校验语句
                                                    </el-tag>
                                                    <el-input class="el-input-parameter" type="textarea"
                                                              :autosize="{ minRows: 3, maxRows: 20}"
                                                              style="display: block;width: 750px"
                                                              :placeholder="outSqlData.sql_str"
                                                              v-model="outSqlData.sql_str">
                                                    </el-input>
                                                </p>
                                                <p style="font-weight: bold;">
                                                    <el-tag style="float:left;margin: 3px" size="medium">后置SQL变量参数
                                                    </el-tag>
                                                    <el-input class="el-input-parameter" type="textarea"
                                                              :autosize="{ minRows: 2, maxRows: 20}"
                                                              style="display: block;width: 750px"
                                                              :placeholder="outSqlData.sql_para"
                                                              v-model="outSqlData.sql_para">
                                                    </el-input>
                                                </p>
                                                <p style="font-weight: bold;">
                                                    <el-tag style="float:left;margin: 1px" size="medium">后置SQL校验预期结果
                                                    </el-tag>
                                                    <el-input class="el-input-parameter" type="textarea"
                                                              :autosize="{ minRows: 2, maxRows: 20}"
                                                              style="display: block;width: 750px"
                                                              :placeholder="outSqlData.expect_db"
                                                              v-model="outSqlData.expect_db">
                                                    </el-input>
                                                </p>
                                                <el-button type="primary" style="float: right;margin: 10px"
                                                           @click="saveOutSql(outSqlData,scope.row)">保存修改
                                                </el-button>
                                                <el-button type="info" style="float: right;margin: 10px"
                                                           @click="pCancel()">
                                                    取消
                                                </el-button>
                                                <span
                                                        style="color: chocolate"
                                                        class="popoverButton"
                                                        slot="reference"
                                                        @click="getOutSql(scope.$index, scope.row,scope.$event)">
                                                    {%verbatim%}
                                                    {{formatOutSql(scope.row,outSqlData)}}
                                                    {%endverbatim%}
                                                </span>
                                            </el-popover>
                                        </template>
                                    </el-table-column>
                                    <el-table-column label="后置变量提取" width="110px" show-overflow-tooltip
                                                     prop="postKeyData">
                                        <template slot-scope="scope">
                                            <el-popover
                                                    class="popover"
                                                    border="0"
                                                    placement="left"
                                                    width="800px"
                                                    trigger="click">
                                                <p style="margin: 10px;font-weight: bold;color: #2140ff">后置变量提取信息配置</p>
                                                <p style="font-weight: bold;">
                                                    <el-tag style="float:left;margin: 3px" size="medium">后置提取变量名
                                                    </el-tag>
                                                    <el-input class="el-input-parameter"
                                                              style="display: block;width: 750px"
                                                              :placeholder="postKeyData.post_keys"
                                                              v-model="postKeyData.post_keys">
                                                    </el-input>
                                                </p>
                                                <p style="font-weight: bold;">
                                                    <el-tag style="float:left;margin: 3px" size="medium">后置变量提取表达式
                                                    </el-tag>
                                                    <el-input class="el-input-parameter" type="textarea"
                                                              :autosize="{ minRows: 1, maxRows: 20}"
                                                              style="display: block;width: 750px"
                                                              :placeholder="postKeyData.post_keys_extractor"
                                                              v-model="postKeyData.post_keys_extractor">
                                                    </el-input>
                                                </p>
                                                <p style="font-weight: bold;">
                                                    <el-tag style="float:left;margin: 1px" size="medium">后置提取变量默认值
                                                    </el-tag>
                                                    <el-input class="el-input-parameter" type="textarea"
                                                              :autosize="{ minRows: 1, maxRows: 20}"
                                                              style="display: block;width: 750px"
                                                              :placeholder="postKeyData.post_keys_default"
                                                              v-model="postKeyData.post_keys_default">
                                                    </el-input>
                                                </p>
                                                <el-button type="primary" style="float: right;margin: 10px"
                                                           @click="savePostKey(postKeyData,scope.row)">保存修改
                                                </el-button>
                                                <el-button type="info" style="float: right;margin: 10px"
                                                           @click="pCancel()">
                                                    取消
                                                </el-button>
                                                <span
                                                        style="color: chocolate"
                                                        class="popoverButtonPost"
                                                        slot="reference"
                                                        v-text="formatPostKey(scope.row,postKeyData)"
                                                        @click="getPostKey(scope.$index, scope.row,scope.$event)">
                                                </span>
                                            </el-popover>
                                        </template>
                                    </el-table-column>
                                    <el-table-column label="操作" width="180px" prop="parameter">
                                        <template slot-scope="scope">
                                            <el-button size="mini" type="success" style="margin: 2px;padding: 5px"
                                                       @click.native.prevent="addNodeRow(nodeData,scope.$index, scope.row)">
                                                添加
                                            </el-button>
                                            <el-button size="mini" type="danger"
                                                       style="margin: 2px;padding: 5px"
                                                       @click="deleteNodeRow(scope.$index,nodeData)">删除
                                            </el-button>
                                            <el-button size="mini" class="saveNode"
                                                       style="display: none;margin: 2px;padding: 5px;float: left"
                                                       type="warning"
                                                       @click="saveNodeEdit(scope.$index, scope.row,scope.$event)">保存
                                            </el-button>
                                            <el-button size="mini" class="editNode" type="primary"
                                                       style="margin: 2px;padding: 5px;float: left"
                                                       @click="editNodeTable(scope.$index, scope.row,scope.$event)">编辑
                                            </el-button>
                                            <el-dialog
                                                    title="删除接口"
                                                    :visible.sync="deleteNodeDialogVisible"
                                                    width="30%">
                                                <span style="color: coral">确定删除当前接口吗？删除后将不可恢复</span>
                                                <span slot="footer" class="dialog-footer">
                                                    <el-button @click="deleteNodeDialogVisible = false">取 消</el-button>
                                                    <el-button type="primary"
                                                               @click="deleteNodeOk(scope.$index, nodeData)">确定删除</el-button>
                                                </span>
                                            </el-dialog>
                                        </template>
                                    </el-table-column>
                                </el-table>
                            </div>
                        </template>
                    </el-table-column>
                </el-table>
            </template>
        </div>
        <div style="margin-top:10px;margin-left: 0px;display: none">
            <el-pagination
                    background
                    layout="prev, pager, next"
                    :total="500">
            </el-pagination>
        </div>
    </div>
    <el-dialog style="font-weight: bold" title="新增接口测试流" :visible.sync="dialogFormVisible">
        <el-form :model="flowDataDefault">
            <el-form-item label="测试流名称" :label-width="formLabelWidth">
                <el-input v-model="flowDataDefault.flow_name" autocomplete="off"
                          placeholder="请输入接口测试流名称（功能模块名称）"></el-input>
            </el-form-item>
            <el-form-item label="测试账号" :label-width="formLabelWidth">
                <el-input v-model="flowDataDefault.account" autocomplete="off"
                          placeholder="请输入测试账号（最好测试环境和线上账号一致）"></el-input>
            </el-form-item>
            <el-form-item label="测试账号密码" :label-width="formLabelWidth">
                <el-input v-model="flowDataDefault.password" autocomplete="off" placeholder="请输入测试账号密码"></el-input>
            </el-form-item>
            <el-form-item label="优先级" :label-width="formLabelWidth">
                <el-input v-model="flowDataDefault.priority" autocomplete="off" placeholder="请设置执行优先级（预留字段）"></el-input>
            </el-form-item>
            <el-form-item label="负责人" :label-width="formLabelWidth">
                <el-input v-model="flowDataDefault.creater" autocomplete="off" placeholder="请输入模块自动化测试负责人"></el-input>
            </el-form-item>
            <el-form-item label="是否开启自动化" :label-width="formLabelWidth">
                <el-select v-model="flowDataDefault.state" placeholder="请选择是否开启自动化">
                    <el-option label="开启自动化" value=1></el-option>
                    <el-option label="关闭自动化" value=0></el-option>
                </el-select>
            </el-form-item>
        </el-form>
        <div slot="footer" class="dialog-footer">
            <el-button @click="dialogFormVisible = false">取 消</el-button>
            <el-button type="primary" @click="addFlowOk(flowDataDefault)">确 定</el-button>
        </div>
    </el-dialog>
    <el-dialog title="新增接口" border :visible.sync="dialogTableVisible" width="1482px">
        <el-table
                :data="nodeDataDefault"
                :header-cell-style="{background:'#606266',color:'#FFFFFF',padding:0}"
                border>
            <el-table-column property="date" label="基本配置" width="720px">
                <template slot-scope="scope">
                    <el-form :model="nodeDataDefault">
                        <div width="50%">
                            <p style="font-weight: bold">
                                <el-tag style="float:left;margin: 1px" size="medium">执行顺序</el-tag>
                                <el-input size="mini" style="margin: 1px;width: 78%" placeholder="请输入接口测试执行顺序序号"
                                          v-model="nodeDataDefault[0].order_id"></el-input>
                            </p>
                            <p style="font-weight: bold;margin: 1px">
                                <el-tag style="float:left;margin: 1px" size="medium">接口名称</el-tag>
                                <el-input size="mini" style="margin: 1px;width: 78%" placeholder="请输入接口名称"
                                          v-model="nodeDataDefault[0].node_name"></el-input>
                            </p>
                            <p style="font-weight: bold;">
                                <el-tag style="float:left;margin: 1px" size="medium">请求方式</el-tag>
                                <el-select size="mini" v-model="nodeDataDefault[0].method"
                                           style="margin: 1px;width: 78%"
                                           placeholder="请选择请求方式">
                                    <el-option label="POST" value="POST"></el-option>
                                    <el-option label="GET" value="GET"></el-option>
                                </el-select>
                            </p>
                            <p style="font-weight: bold;">
                                <el-tag style="float:left;margin: 1px" size="medium">接口路径</el-tag>
                                <el-input size="mini" style="margin: 1px;width: 78%" placeholder="请输入接口请求路径"
                                          v-model="nodeDataDefault[0].path"></el-input>
                            </p>
                            <p style="font-weight: bold;">
                                <el-tag style="float:left;margin: 1px" size="medium">请求参数</el-tag>
                                <el-input :autosize="{ minRows: 13, maxRows: 20}" size="mini" type="textarea"
                                          style="margin: 1px;width: 78%"
                                          placeholder="请输入接口请求参数（JSON格式，变量以 $变量$形式输入）"
                                          v-model="nodeDataDefault[0].parameter"></el-input>
                            </p>
                            <p style="font-weight: bold;">
                                <el-tag style="float:left;margin: 1px" size="medium">请求变量</el-tag>
                                <el-input size="mini" style="margin: 1px;width: 78%" placeholder="请输入接口请求引用的变量名称"
                                          v-model="nodeDataDefault[0].pre_keys"></el-input>
                            </p>
                            <p style="font-weight: bold;">
                                <el-tag style="float:left;margin: 1px" size="medium">预期结果</el-tag>
                                <el-input :autosize="{ minRows: 1, maxRows: 10}" size="mini"
                                          style="margin: 1px;width: 78%"
                                          type="textarea"
                                          placeholder="请输入接口响应校验正则表达式（多个以|隔开）"
                                          v-model="nodeDataDefault[0].expect_response"></el-input>
                            </p>
                            <p style="font-weight: bold;">
                                <el-tag style="float:left;margin: 1px" size="medium">接口状态</el-tag>
                                <el-select size="mini" v-model="nodeDataDefault[0].state"
                                           style="margin: 1px;width: 78%"
                                           placeholder="请设置是否启用前置SQL查询（1：启用/0：不启用）">
                                    <el-option label="开启接口" value=1></el-option>
                                    <el-option label="关闭接口" value=0></el-option>
                                </el-select>
                            </p>
                            <p style="font-weight: bold;">
                                <el-tag style="float:left;margin: 1px" size="medium">等待时间</el-tag>
                                <el-input size="mini" style="margin: 1px;width: 78%"
                                          placeholder="请输入当前接口请求完成后需要等待时间间隔（单位：毫秒）"
                                          v-model="nodeDataDefault[0].sleep_time"></el-input>
                            </p>
                        </div>
                    </el-form>
                </template>
            </el-table-column>
            <el-table-column property="name" label="其他配置" width="720px">
                <template slot-scope="scope">
                    <el-form :model="nodeDataDefault">
                        <div width="50%">
                            <el-divider content-position="center">前置SQL查询信息配置</el-divider>
                            <p style="font-weight: bold;border: lime">
                                <el-tag style="float:left;margin: 1px" size="medium">前置开关</el-tag>
                                <el-select size="mini" v-model="nodeDataDefault[0].isexcute_pre_sql"
                                           style="margin: 1px;width: 78%"
                                           placeholder="请设置是否启用前置SQL查询（1：启用/0：不启用）">
                                    <el-option label="开启前置SQL查询" value=1></el-option>
                                    <el-option label="关闭前置SQL查询" value=0></el-option>
                                </el-select>
                            </p>
                            <p style="font-weight: bold;border: lime">
                                <el-tag style="float:left;margin: 1px" size="medium">SQL语句</el-tag>
                                <el-input :autosize="{ minRows: 1, maxRows: 10}" size="mini" type="textarea"
                                          style="margin: 1px;width: 78%" placeholder="请输入前置查询SQL语句（变量用 $变量$ 格式引用）"
                                          v-model="nodeDataDefault[0].pre_sql_str"></el-input>
                            </p>
                            <p style="font-weight: bold;border: lime">
                                <el-tag style="float:left;margin: 1px" size="medium">SQL变量</el-tag>
                                <el-input size="mini" style="margin: 1px;width: 78%" placeholder="请输入需要引用的变量名称"
                                          v-model="nodeDataDefault[0].pre_sql_para"></el-input>
                            </p>
                            <p style="font-weight: bold;border: lime">
                                <el-tag style="float:left;margin: 1px" size="medium">接收变量</el-tag>
                                <el-input size="mini" style="margin: 1px;width: 78%"
                                          placeholder="请输入接收查询结果的变量名称（多个以分号隔开）"
                                          v-model="nodeDataDefault[0].pre_sql_out"></el-input>
                            </p>
                            <el-divider content-position="center">后置SQL校验信息配置</el-divider>
                            <p style="font-weight: bold;">
                                <el-tag style="float:left;margin: 1px" size="medium">后置开关</el-tag>
                                <el-select size="mini" v-model="nodeDataDefault[0].ischechdb"
                                           style="margin: 1px;width: 78%">
                                    <el-option label="开启后置SQL校验" value=1></el-option>
                                    <el-option label="关闭后置SQL校验" value=0></el-option>
                                </el-select>
                            </p>
                            <p style="font-weight: bold;">
                                <el-tag style="float:left;margin: 1px" size="medium">SQL语句</el-tag>
                                <el-input :autosize="{ minRows: 1, maxRows: 10}" size="mini" type="textarea"
                                          style="margin: 1px;width: 78%" placeholder="请输入后置查询SQL语句（变量用 $变量$ 格式引用）"
                                          v-model="nodeDataDefault[0].sql_str"></el-input>
                            </p>
                            <p style="font-weight: bold;">
                                <el-tag style="float:left;margin: 1px" size="medium">SQL变量</el-tag>
                                <el-input size="mini" style="margin: 1px;width: 78%" placeholder="请输入需要引用的变量名称"
                                          v-model="nodeDataDefault[0].sql_para"></el-input>
                            </p>
                            <p style="font-weight: bold;">
                                <el-tag style="float:left;margin: 1px" size="medium">SQL预期</el-tag>
                                <el-input size="mini" style="margin: 1px;width:78%"
                                          placeholder="请输入SQL校验预期结果（以Json格式输入）"
                                          v-model="nodeDataDefault[0].expect_db"></el-input>
                            </p>
                            <el-divider content-position="center">接口请求后置变量提取配置</el-divider>
                            <p style="font-weight: bold;">
                                <el-tag style="float:left;margin: 1px" size="medium">后置变量</el-tag>
                                <el-input size="mini" style="margin: 1px;width: 78%"
                                          placeholder="请输入需要提取的参数接收变量（多个以分号隔开）"
                                          v-model="nodeDataDefault[0].post_keys"></el-input>
                            </p>
                            <p style="font-weight: bold;">
                                <el-tag style="float:left;margin: 1px" size="medium">提取公式</el-tag>
                                <el-input :autosize="{ minRows: 1, maxRows: 10}" size="mini" type="textarea"
                                          style="margin: 1px;width: 78%"
                                          placeholder="请输入参数提取表达式（格式：$.data.xxx 多个以分号隔开）"
                                          v-model="nodeDataDefault[0].post_keys_extractor"></el-input>
                            </p>
                            <p style="font-weight: bold;">
                                <el-tag style="float:left;margin: 1px" size="medium">默认取值</el-tag>
                                <el-input size="mini" style="margin: 1px;width: 78%"
                                          placeholder="请输入提取参数默认值（与提取变量个数和顺序匹配（如：0；0；0））"
                                          v-model="nodeDataDefault[0].post_keys_default"></el-input>
                            </p>
                        </div>

                    </el-form>
                </template>
            </el-table-column>
        </el-table>
        <div slot="footer" class="dialog-footer">
            <el-button @click="dialogTableVisible = false">取 消</el-button>
            <el-button type="primary" @click="addNodeOk(nodeDataDefault)">确 定</el-button>
        </div>
    </el-dialog>
</div>
<script type="text/javascript">
    var vm = new Vue({
        el: '#app',
        mounted: function () {
            this.$http.get(this.url+'/getFlowData').then(
                function (data) {
                    this.flowData = data.body;
                }
            );
        },
        data() {
            return {
                url:'http://172.16.10.172:8000',
                filtrate: '',
                creater: [
                    {
                        "creater": "全部负责人"
                    }, {
                        "creater": "柳军"
                    }, {
                        "creater": "陈俊波"
                    }, {
                        "creater": "崔庆用"
                    }, {
                        "creater": "余一鸣"
                    }, {
                        "creater": "陆金爱"
                    }, {
                        "creater": "刘鎏"
                    },  {
                        "creater": "余伟鹏"
                    }],
                deleteFlowId: '',
                deleteNodeId: '',
                nodeFlowId: '',
                isCollapse: true,
                nodeDataDefault: [
                    {
                        "pk": "",
                        "order_id": "",
                        "node_name": "",
                        "method": "POST",
                        "path": "",
                        "parameter": "",
                        "expect_response": "",
                        "sleep_time": 0,
                        "state": "0",
                        "isexcute_pre_sql": "0",
                        "pre_keys": "",
                        "pre_sql_str": "",
                        "pre_sql_para": "",
                        "pre_sql_out": "",
                        "ischechdb": "0",
                        "sql_str": "",
                        "sql_para": "",
                        "expect_db": "",
                        "post_keys": "",
                        "post_keys_extractor": "",
                        "post_keys_default": "",
                    }
                ],
                flowDataDefault: {
                    "pk": "",
                    "flow_name": "",
                    "account": "",
                    "password": "",
                    "priority": "1",
                    "creater": "",
                    "state": "1"
                },
                activeIndex2: '3',
                modal1: false,
                search: '',
                modal2: false,
                flowData: [],
                nodeData: [],
                outSqlData: [],
                postKeyData: [],
                preSqlData: [],
                parameterData: [],
                currentRow: '',
                value: true,
                visible: false,
                dialogFormVisible: false,
                deleteFlowDialogVisible: false,
                deleteNodeDialogVisible: false,
                dialogTableVisible: false,
                formLabelWidth: '120px',
                actionLoading:false
            }
        },
        methods: {
            handleOpen(key, keyPath) {
                console.log(key, keyPath);
            },
            handleClose(key, keyPath) {
                console.log(key, keyPath);
            },
            savePostKey(postKeyData, row) {
                console.log("node_id", row.pk);
                console.log("postKeyData", postKeyData);
                this.loading = true;
                var dataPost = {
                    "node_id": row.pk,
                    "post_keys": postKeyData.post_keys,
                    "post_keys_extractor": postKeyData.post_keys_extractor,
                    "post_keys_default": postKeyData.post_keys_default
                };
                this.$http.post(this.url+'/savePostKey', dataPost).then(
                    function (data) {
                        var responData = data.status;
                        console.log("responData=", responData);
                        if (responData === 200 || responData === '200') {
                            console.log("this.nodeData=", this.nodeData);
                            var nodeTable = document.getElementById('nodeTable');
                            var currentRow = nodeTable.getElementsByClassName('el-table__body')[0].getElementsByClassName("current-row")[0];
                            if (postKeyData.post_keys != null && postKeyData.post_keys > 0 && postKeyData.post_keys !== "") {
                                currentRow.getElementsByClassName("popoverButtonPost")[0].innerHTML = '已提取后置变量';
                            } else {
                                currentRow.getElementsByClassName("popoverButtonPost")[0].innerHTML = '未提取后置变量';
                            }
                            console.log("postKeyData=", this.postKeyData);
                            row.post_keys = postKeyData.post_keys;
                            row.post_keys_extractor = postKeyData.post_keys_extractor;
                            row.post_keys_default = postKeyData.post_keys_default;
                            this.$message({
                                showClose: true,
                                message: '恭喜你，后置变量提取设置成功',
                                type: 'success'
                            });
                            document.body.click();
                        } else {
                            this.postKeyData = {
                                "post_keys": row.post_keys,
                                "post_keys_extractor": row.post_keys_extractor,
                                "post_keys_default": row.post_keys_default
                            };
                            this.$message({
                                showClose: true,
                                message: '很抱歉，后置变量提取设置失败',
                                type: 'error'
                            });
                        }
                    }
                );

            },
            saveParameter(parameterData, row) {
                this.loading = true;
                var dataPost = {"node_id": row.pk, "parameter": row.parameter};
                this.$http.post(this.url+'/editParameter', dataPost).then(
                    function (data) {
                        var responData = data.status;
                        if (responData === 200 || responData === '200') {
                            this.$message({
                                showClose: true,
                                message: '保存成功',
                                type: 'success'
                            });
                            this.parameterData = [
                                {
                                    "key": "接口请求参数",
                                    "value": row.parameter
                                }
                            ]
                        } else {
                            row.parameter = this.parameterData[0].value;
                            this.$message({
                                showClose: true,
                                message: '很遗憾，保存失败',
                                type: 'error'
                            });
                        }

                    }
                );
                document.body.click();
            },
            saveOutSql(outSqlData, row) {
                this.loading = true;
                var dataPost = {
                    "node_id": row.pk,
                    "ischechdb": outSqlData.ischechdb,
                    "sql_str": outSqlData.sql_str,
                    "sql_para": outSqlData.sql_para,
                    "expect_db": outSqlData.expect_db
                };
                this.$http.post(this.url+'/editOutSql', dataPost).then(
                    function (data) {
                        var responData = data.status;
                        if (responData === 200 || responData === '200') {
                            var nodeTable = document.getElementById('nodeTable');
                            var currentRow = nodeTable.getElementsByClassName('el-table__body')[0].getElementsByClassName("current-row")[0];
                            if (outSqlData.ischechdb === '1' || outSqlData.ischechdb === 1) {
                                currentRow.getElementsByClassName("popoverButton")[0].innerHTML = '已开启SQL校验';
                            } else if (outSqlData.ischechdb === '0' || outSqlData.ischechdb === 0) {
                                currentRow.getElementsByClassName("popoverButton")[0].innerHTML = '已关闭SQL校验';
                            } else {
                                currentRow.getElementsByClassName("popoverButton")[0].innerHTML = '未配置SQL校验';
                            }
                            row.ischechdb = outSqlData.ischechdb;
                            row.sql_str = outSqlData.sql_str;
                            row.sql_para = outSqlData.sql_para;
                            row.expect_db = outSqlData.expect_db;
                            document.body.click();
                            this.$message({
                                showClose: true,
                                message: '保存成功',
                                type: 'success'
                            });
                        } else {
                            this.outSqlData = {
                                "ischechdb": row.ischechdb,
                                "sql_str": row.sql_str,
                                "sql_para": row.sql_para,
                                "expect_db": row.expect_db
                            };
                            this.$message({
                                showClose: true,
                                message: '很遗憾，保存失败',
                                type: 'error'
                            });
                        }
                    }
                );
            },
            savePreSql(preSqlData, row) {
                this.loading = true;
                var dataPost = {
                    "node_id": row.pk,
                    "isexcute_pre_sql": preSqlData.isexcute_pre_sql,
                    "pre_sql_str": preSqlData.pre_sql_str,
                    "pre_sql_para": preSqlData.pre_sql_para,
                    "pre_sql_out": preSqlData.pre_sql_out,
                };
                this.$http.post(this.url+'/editPreSql', dataPost).then(
                    function (data) {
                        var responData = data.status;
                        if (responData === 200 || responData === '200') {
                            var nodeTable = document.getElementById('nodeTable');
                            var currentRow = nodeTable.getElementsByClassName('el-table__body')[0].getElementsByClassName("current-row")[0];
                            if (preSqlData.isexcute_pre_sql === '1' || preSqlData.isexcute_pre_sql === 1) {
                                currentRow.getElementsByClassName("popoverButtonPre")[0].innerHTML = '已开启前置SQL查询';
                            } else if (preSqlData.isexcute_pre_sql === '0' || preSqlData.isexcute_pre_sql === 0) {
                                currentRow.getElementsByClassName("popoverButtonPre")[0].innerHTML = '已关闭前置SQL查询';
                            } else {
                                currentRow.getElementsByClassName("popoverButtonPre")[0].innerHTML = '未配置前置SQL校验';
                            }
                            row.isexcute_pre_sql = preSqlData.isexcute_pre_sql;
                            row.pre_sql_str = preSqlData.pre_sql_str;
                            row.pre_sql_para = preSqlData.pre_sql_para;
                            row.pre_sql_out = preSqlData.pre_sql_out;
                            document.body.click();
                            this.$message({
                                showClose: true,
                                message: '保存成功',
                                type: 'success'
                            });
                        } else {
                            this.preSqlData = {
                                "isexcute_pre_sql": row.isexcute_pre_sql,
                                "pre_sql_str": row.pre_sql_str,
                                "pre_sql_para": row.pre_sql_para,
                                "pre_sql_out": row.pre_sql_out
                            };
                            this.$message({
                                showClose: true,
                                message: '很遗憾，保存失败',
                                type: 'error'
                            });
                        }
                    }
                );
            },
            formatState: function (row, column) {
                return row.state === 1 || row.state === '1' ? '已启用' : row.state === 0 || row.state === '0' ? '已关闭' : '未设置'
            },
            formatPreSql: function (row, column) {
                return row.isexcute_pre_sql === 1 || row.isexcute_pre_sql === '1' ? '已开启前置SQL查询' : row.isexcute_pre_sql === 0 || row.isexcute_pre_sql === '0' ? '已关闭前置SQL查询' : '未配置前置SQL查询'
            },
            formatOutSql: function (row, column) {
                return row.ischechdb === 1 || row.ischechdb === '1' ? '已开启SQL校验' : row.ischechdb === 0 || row.ischechdb === '0' ? '已关闭SQL校验' : '未配置SQL校验'
            },
            formatStateNode: function (row, column) {
                console.log("row", row);
                return row.state === 1 || row.state === '1' ? '已开启接口' : row.state === 0 || row.state === '0' ? '已关闭接口' : '未设置接口状态'
            },
            formatPostKey: function (row, formatPostKey) {
                return row.post_keys != null && row.post_keys.length > 0 && row.post_keys !== "" ? '已提取后置变量' : '未提取后置变量';
            },
            handleSelect(key, keyPath) {
                console.log(key, keyPath);
            },
            filterHandler(value, row, column) {
                const property = column['prop'];
                return row[property] === value;
            },
            getOutSql(index, row, even) {
                this.currentRow = document.getElementById('nodeTable').getElementsByClassName('el-table__body')[0].getElementsByClassName("current-row ")[0];
                console.log('getOutSql-index', index);
                console.log('getOutSql-this.currentRow', this.currentRow);
                this.outSqlData = '';
                this.loading = true;
                var dataPost = {"node_id": row.pk};
                this.$http.post(this.url+'/getOutSql', dataPost).then(
                    function (data) {
                        var responData = data.body;
                        console.log("responData=", responData);
                        this.outSqlData = {
                            "ischechdb": responData[0].ischechdb,
                            "sql_str": responData[0].sql_str,
                            "sql_para": responData[0].sql_para,
                            "expect_db": responData[0].expect_db
                        };
                        console.log("outSqlData=", this.outSqlData);
                    }
                )
            },
            getPreSql(index, row) {
                this.currentRow = document.getElementById('nodeTable').getElementsByClassName('el-table__body')[0].getElementsByClassName("current-row ")[0];
                console.log('getPreSql-index', index);
                console.log('getPreSql-row', row);
                console.log('getPreSql-this.currentRow', this.currentRow);
                this.loading = true;
                this.preSqlData = '';
                var dataPost = {"node_id": row.pk};
                this.$http.post(this.url+'/getPreSql', dataPost).then(
                    function (data) {
                        var responData = data.body;
                        console.log("responData=", responData);
                        this.preSqlData = {
                            "isexcute_pre_sql": responData[0].isexcute_pre_sql,
                            "pre_sql_str": responData[0].pre_sql_str,
                            "pre_sql_para": responData[0].pre_sql_para,
                            "pre_sql_out": responData[0].pre_sql_out
                        };
                        console.log("preSqlData=", this.preSqlData);
                    }
                )
            },
            getPostKey(index, row) {
                this.currentRow = document.getElementById('nodeTable').getElementsByClassName('el-table__body')[0].getElementsByClassName("current-row ")[0];
                console.log('getPostKey-index', index);
                console.log('getPostKey-this.currentRow', this.currentRow);
                this.postKeyData = '';
                this.loading = true;
                var dataPost = {"node_id": row.pk};
                this.$http.post(this.url+'/getPostKey', dataPost).then(
                    function (data) {
                        var responData = data.body;
                        console.log("responData=", responData);
                        this.postKeyData = {
                            "post_keys": responData[0].post_keys,
                            "post_keys_extractor": responData[0].post_keys_extractor,
                            "post_keys_default": responData[0].post_keys_default
                        };
                        console.log("postKeyDataGet=", this.postKeyData);
                    }
                )
            },
            getParameter(index, row) {
                this.currentRow = document.getElementById('nodeTable').getElementsByClassName('el-table__body')[0].getElementsByClassName("current-row ")[0];
                this.loading = true;
                this.parameterData = '';
                console.log('getParameter-index', index);
                console.log('getParameter-this.currentRow', this.currentRow);
                var dataPost = {"node_id": row.pk};
                this.$http.post(this.url+'/getParameter', dataPost).then(
                    function (data) {
                        var responData = data.body;
                        console.log("responData=", responData);
                        this.parameterData = [{
                            "key": "接口请求参数",
                            "value": responData[0].parameter
                        }];
                        console.log("parameterData=", this.parameterData);
                    }
                )
            },
            addFlowRow(flowData) {
                flowData.push({
                    "account": "请输入测试账号",
                    "flow_name": "请输入测试流",
                    "password": "请输入测试账号密码",
                    "priority": "请设置优先级",
                    "creater": "请输入负责人",
                    "state": "请设置是否开启自动化",
                    "pk": flowData.length + 1
                })
            },
            addNodeRow(nodeData) {
                nodeData.push({
                    "order_id": nodeData.length + 1,
                    "node_name": "",
                    "method": "",
                    "path": "",
                    "parameter": "",
                    "pre_keys": "",
                    "sleep_time": "",
                    "state": "0",
                    "expect_response": "",
                    "isexcute_pre_sql": "0",
                    "pre_sql_str": "",
                    "pre_sql_para": "",
                    "pre_sql_out": "",
                    "ischechdb": "0",
                    "sql_str": "",
                    "sql_para": "",
                    "expect_db": "",
                    'post_keys': "",
                    'post_keys_extractor': "",
                    'post_keys_default': "",
                    "pk": nodeData.length + 1
                })
            },
            saveFlowEdit(index, row) {
                var flowTable = document.getElementById('flowTable');
                var currentRow = flowTable.getElementsByClassName('el-table__body')[0].getElementsByClassName("el-table__row")[index];
                for (var i = 1; i < currentRow.children.length - 2; i++) {
                    var cell = currentRow.children[i].getElementsByClassName('cell')[0];
                    var elInput = cell.children[0];
                    var elSpan = cell.children[1];
                    elInput.style.display = 'none';
                    elSpan.style.display = 'block';
                    cell.style.color = 'black';
                }
                this.loading = true;
                var dataPost = {
                    "account": row.account,
                    "flow_name": row.flow_name,
                    "password": row.password,
                    "priority": row.priority,
                    "creater": row.creater,
                    "state": row.state,
                    "pk": row.pk
                };
                this.$http.post(this.url+'/editFlow', dataPost).then(
                    function (data) {
                        var responData = data.status;
                        if (responData === 200 || responData === '200') {
                            this.$message({
                                showClose: true,
                                message: '恭喜你，保存成功',
                                type: 'success'
                            });
                            currentRow.children[7].getElementsByClassName('save')[0].style.display = 'none';
                            currentRow.children[7].getElementsByClassName('edit')[0].style.display = 'block';
                        } else {
                            this.$message({
                                showClose: true,
                                message: '很遗憾，保存失败，快查查原因吧',
                                type: 'error'
                            });
                        }
                    }
                );
            },
            dbEditFlowTable(index, row) {
                var flowTable = document.getElementById('flowTable');
                console.log("flowTable", flowTable);
                var currentRow = flowTable.getElementsByClassName('el-table__body')[0].getElementsByClassName("current-row")[0];
                console.log("currentRow", currentRow);
                for (var i = 1; i < currentRow.children.length - 2; i++) {
                    var cell = currentRow.children[i].getElementsByClassName('cell')[0];
                    var elInput = cell.children[0];
                    var elSpan = cell.children[1];
                    elInput.style.display = 'block';
                    elSpan.style.display = 'none';
                    cell.style.color = 'blue';
                }
                currentRow.children[7].getElementsByClassName('save')[0].style.display = 'block';
                currentRow.children[7].getElementsByClassName('edit')[0].style.display = 'none';
                console.log("row", row);
                console.log("index", index);
            },
            editFlowTable(index, row) {
                var flowTable = document.getElementById('flowTable');
                console.log("flowTable", flowTable);
                var currentRow = flowTable.getElementsByClassName('el-table__body')[0].getElementsByClassName("el-table__row")[index];
                console.log("currentRow", currentRow);
                for (var i = 1; i < currentRow.children.length - 2; i++) {
                    var cell = currentRow.children[i].getElementsByClassName('cell')[0];
                    var elInput = cell.children[0];
                    var elSpan = cell.children[1];
                    elInput.style.display = 'block';
                    elSpan.style.display = 'none';
                    cell.style.color = 'blue';
                }
                currentRow.children[7].getElementsByClassName('save')[0].style.display = 'block';
                currentRow.children[7].getElementsByClassName('edit')[0].style.display = 'none';
                console.log("row", row);
                console.log("index", index);
            },
            editNodeTable(index, row) {
                console.log("this.currentRow", this.currentRow);
                var nodeTable = document.getElementById('nodeTable');
                var currentRow = nodeTable.getElementsByClassName('el-table__body')[0].getElementsByClassName("el-table__row")[index];
                console.log("editNodeTable-index", index);
                console.log("editNodeTable-row", row);
                console.log("editNodeTable-nodeTable", nodeTable);
                console.log("editNodeTable-currentRow", currentRow);
                console.log("editNodeTable-el-table__row", nodeTable.getElementsByClassName('el-table__body')[0].getElementsByClassName("el-table__row"));
                for (var i = 0; i < currentRow.children.length - 4; i++) {
                    var cell = currentRow.children[i].getElementsByClassName('cell')[0];
                    var elInput = cell.children[0];
                    var elSpan = cell.children[1];
                    elInput.style.display = 'block';
                    elSpan.style.display = 'none';
                    cell.style.color = 'blue';
                }
                currentRow.children[12].getElementsByClassName('saveNode')[0].style.display = 'block';
                currentRow.children[12].getElementsByClassName('editNode')[0].style.display = 'none';
            },
            dbEditNodeTable(index, row) {
                var nodeTable = document.getElementById('nodeTable');
                var currentRow = nodeTable.getElementsByClassName('el-table__body')[0].getElementsByClassName("current-row")[0];
                console.log("dbEditNodeTable-row=", row);
                console.log("dbEditNodeTable-this.currentRow=", this.currentRow);
                console.log("dbEditNodeTable-index=", index);
                console.log("dbEditNodeTable-nodeTable=", nodeTable);
                console.log("dbEditNodeTable-currentRow=", currentRow);
                for (var i = 0; i < currentRow.children.length - 4; i++) {
                    var cell = currentRow.children[i].getElementsByClassName('cell')[0];
                    var elInput = cell.children[0];
                    var elSpan = cell.children[1];
                    elInput.style.display = 'block';
                    elSpan.style.display = 'none';
                    cell.style.color = 'blue';
                }
                currentRow.children[12].getElementsByClassName('saveNode')[0].style.display = 'block';
                currentRow.children[12].getElementsByClassName('editNode')[0].style.display = 'none';
            },
            saveNodeEdit(index, row, event) {
                var nodeTable = document.getElementById('nodeTable');
                var currentRow = nodeTable.getElementsByClassName('el-table__body')[0].getElementsByClassName("el-table__row")[index];
                console.log("this.currentRow", this.currentRow);
                console.log("saveNodeEdit-row", row);
                console.log("saveNodeEdit-index", index);
                console.log("saveNodeEdit-nodeTable", nodeTable);
                console.log("saveNodeEdit-currentRow", currentRow);

                for (var i = 0; i < currentRow.children.length - 4; i++) {
                    var cell = currentRow.children[i].getElementsByClassName('cell')[0];
                    var elInput = cell.children[0];
                    var elSpan = cell.children[1];
                    elInput.style.display = 'none';
                    elSpan.style.display = 'block';
                    cell.style.color = 'black';
                }
                this.loading = true;
                var dataPost = {
                    "order_id": row.order_id,
                    "flow_id": this.nodeFlowId,
                    "node_name": row.node_name,
                    "method": row.method,
                    "path": row.path,
                    "parameter": row.parameter,
                    "pre_keys": row.pre_keys,
                    "sleep_time": row.sleep_time,
                    "state": row.state,
                    "expect_response": row.expect_response,
                    "isexcute_pre_sql": row.isexcute_pre_sql,
                    "pre_sql_str": row.pre_sql_str,
                    "pre_sql_para": row.pre_sql_para,
                    "pre_sql_out": row.pre_sql_out,
                    "ischechdb": row.ischechdb,
                    "sql_str": row.sql_str,
                    "sql_para": row.sql_para,
                    "expect_db": row.expect_db,
                    'post_keys': row.post_keys,
                    'post_keys_extractor': row.post_keys_extractor,
                    'post_keys_default': row.post_keys_default,
                    "pk": row.pk
                };
                this.$http.post(this.url+'/editNode', dataPost).then(
                    function (data) {
                        var responData = data.status;
                        if (responData === 200 || responData === '200') {
                            this.$message({
                                showClose: true,
                                message: '恭喜你，保存成功',
                                type: 'success'
                            });
                            currentRow.children[12].getElementsByClassName('saveNode')[0].style.display = 'none';
                            currentRow.children[12].getElementsByClassName('editNode')[0].style.display = 'block';
                        } else {
                            this.$message({
                                showClose: true,
                                message: '很遗憾，保存失败，快查查原因吧',
                                type: 'error'
                            });
                        }
                    }
                );
                this.currentRow = currentRow;
                console.log("saveNodeEdit-this.currentRow2", this.currentRow)
            },
            addFlowOk(flowDataDefault) {
                var account = flowDataDefault.account;
                var flow_name = flowDataDefault.flow_name;
                var password = flowDataDefault.password;
                var priority = flowDataDefault.priority;
                var creater = flowDataDefault.creater;
                var state = flowDataDefault.state;

                if (state === null || state === undefined) {
                    alert("请选择是否开启自动化")
                } else {
                    this.loading = true;
                    var dataPost = {
                        "account": account,
                        "flow_name": flow_name,
                        "password": password,
                        "priority": priority,
                        "creater": creater,
                        "state": state,
                        "pk": this.flowData.length + 1
                    };
                    this.$http.post(this.url+'/addFlow', dataPost).then(
                        function (data) {
                            var responData = data.status;
                            if (responData === 200 || responData === '200') {
                                this.$message({
                                    showClose: true,
                                    message: '恭喜你，添加成功',
                                    type: 'success'
                                });
                                this.flowData.push(dataPost);
                            } else {
                                this.$message({
                                    showClose: true,
                                    message: '很遗憾，添加失败了，快查查原因吧',
                                    type: 'error'
                                });
                            }
                        }
                    );
                }
            },
            addNodeOk(nodeDataDefault) {
                this.loading = true;
                if (nodeDataDefault[0].order_id === '') {
                    this.$message({
                        showClose: true,
                        message: '执行顺序不能为空，请填写',
                        type: 'error'
                    });
                } else {
                    console.log("nodeDataDefault=", nodeDataDefault);
                    var dataPost = {
                        "order_id": nodeDataDefault[0].order_id,
                        "flow_id": this.nodeFlowId,
                        "node_name": nodeDataDefault[0].node_name,
                        "method": nodeDataDefault[0].method,
                        "path": nodeDataDefault[0].path,
                        "parameter": nodeDataDefault[0].parameter,
                        "pre_keys": nodeDataDefault[0].pre_keys,
                        "sleep_time": nodeDataDefault[0].sleep_time,
                        "state": nodeDataDefault[0].state,
                        "expect_response": nodeDataDefault[0].expect_response,
                        "isexcute_pre_sql": nodeDataDefault[0].isexcute_pre_sql,
                        "pre_sql_out": nodeDataDefault[0].pre_sql_out,
                        "pre_sql_para": nodeDataDefault[0].pre_sql_para,
                        "pre_sql_str": nodeDataDefault[0].pre_sql_str,
                        "expect_db": nodeDataDefault[0].expect_db,
                        "ischechdb": nodeDataDefault[0].ischechdb,
                        "sql_para": nodeDataDefault[0].sql_para,
                        "sql_str": nodeDataDefault[0].sql_str,
                        'post_keys': nodeDataDefault[0].post_keys,
                        'post_keys_extractor': nodeDataDefault[0].post_keys_extractor,
                        'post_keys_default': nodeDataDefault[0].post_keys_default,
                    };
                    console.log("DataPost=", dataPost);
                    this.$http.post(this.url+'/addNode', dataPost).then(
                        function (data) {
                            console.log(dataPost);
                            var responData = data.status;
                            var node_id = data.body[0].node_id;
                            if (responData === 200 || responData === '200') {
                                this.$message({
                                    showClose: true,
                                    message: '恭喜你，添加成功',
                                    type: 'success'
                                });
                                this.nodeData.push(
                                    {
                                        "order_id": nodeDataDefault[0].order_id,
                                        "flow_id": this.nodeFlowId,
                                        "node_name": nodeDataDefault[0].node_name,
                                        "method": nodeDataDefault[0].method,
                                        "path": nodeDataDefault[0].path,
                                        "parameter": nodeDataDefault[0].parameter,
                                        "pre_keys": nodeDataDefault[0].pre_keys,
                                        "sleep_time": nodeDataDefault[0].sleep_time,
                                        "state": nodeDataDefault[0].state,
                                        "expect_response": nodeDataDefault[0].expect_response,
                                        "isexcute_pre_sql": nodeDataDefault[0].isexcute_pre_sql,
                                        "pre_sql_out": nodeDataDefault[0].pre_sql_out,
                                        "pre_sql_para": nodeDataDefault[0].pre_sql_para,
                                        "pre_sql_str": nodeDataDefault[0].pre_sql_str,
                                        "expect_db": nodeDataDefault[0].expect_db,
                                        "ischechdb": nodeDataDefault[0].ischechdb,
                                        "sql_para": nodeDataDefault[0].sql_para,
                                        "sql_str": nodeDataDefault[0].sql_str,
                                        'post_keys': nodeDataDefault[0].post_keys,
                                        'post_keys_extractor': nodeDataDefault[0].post_keys_extractor,
                                        'post_keys_default': nodeDataDefault[0].post_keys_default,
                                        "pk": node_id
                                    });
                            } else {
                                this.$message({
                                    showClose: true,
                                    message: '很遗憾，添加失败了，快查查原因吧',
                                    type: 'error'
                                });
                            }
                        }
                    );
                }
            },
            addFlowCancel() {
                document.body.click();
            },
            addNodeCancel() {
                document.body.click();
            },
            pCancel(row) {
                document.body.click();
            },
            expandChange(row, expandedRows, index) {
                this.loading = true;
                if (expandedRows.length > 1) {
                    this.expands = [];
                    if (row) {
                        this.expands.splice(index, 1);
                    }
                    this.$refs.flowTableRef.toggleRowExpansion(expandedRows[0]);
                    this.nodeFlowId = row.pk;
                    console.log("expandChange-nodeFlowId", this.nodeFlowId);
                    var dataPost = {"flow_id": row.pk};
                    this.$http.post(this.url+'/getNodeData', dataPost).then(
                        function (data) {
                            this.nodeData = data.body;
                            this.currentRow = '';
                        }
                    );
                } else {
                    this.expands = [];
                    this.nodeFlowId = row.pk;
                    console.log("expandChange-nodeFlowId", this.nodeFlowId);
                    var dataPost = {"flow_id": row.pk};
                    this.$http.post(this.url+'/getNodeData', dataPost).then(
                        function (data) {
                            this.nodeData = data.body;
                            this.currentRow = '';
                        }
                    );
                }
            },
            formatJson(row, index) {
                text = row.parameter;
                if (text.indexOf("$") !== -1) {
                    row.parameter = JSON.stringify(JSON.parse(text.replace(/\:\$/g, "\:\"\$").replace(/\$\,/g, "\$\"\,").replace(/\$\}/g, "\$\"\}").replace(/\[\$/g, "\[\"\$").replace(/\$\]/g, "\$\"\]")), null, 2);
                } else {
                    row.parameter = JSON.stringify(JSON.parse(text), null, 2);
                }
            },
            deleteFlowRow(index, rows) {
                this.deleteFlowId = rows[index].pk;
                rows.splice(index, 1);
                this.deleteFlowDialogVisible = true;
            },
            deleteNodeRow(index, rows) {
                this.deleteNodeId = rows[index].pk;
                rows.splice(index, 1);
                this.deleteNodeDialogVisible = true;
            },
            deleteFlowOk() {
                this.loading = true;
                var dataPost = {
                    "flow_id": this.deleteFlowId,
                };
                this.$http.post(this.url+'/deleteFlow', dataPost).then(
                    function (data) {
                        var responData = data.status;
                        if (responData === 200 || responData === '200') {
                            this.$message({
                                showClose: true,
                                message: '恭喜你，删除成功',
                                type: 'success'
                            });
                            this.deleteFlowDialogVisible = false
                        } else {
                            this.$message({
                                showClose: true,
                                message: '很遗憾，删除失败，快查查原因吧',
                                type: 'error'
                            });
                        }
                    }
                );
            },
            deleteNodeOk() {
                this.loading = true;
                var dataPost = {
                    "node_id": this.deleteNodeId,
                };
                this.$http.post(this.url+'/deleteNode', dataPost).then(
                    function (data) {
                        var responData = data.status;
                        if (responData === 200 || responData === '200') {
                            this.$message({
                                showClose: true,
                                message: '恭喜你，删除成功',
                                type: 'success'
                            });
                            this.deleteNodeDialogVisible = false
                        } else {
                            this.$message({
                                showClose: true,
                                message: '很遗憾，删除失败，快查查原因吧',
                                type: 'error'
                            });
                        }
                    }
                );
            },
            rowClick(row, column, event) {
                console.log("this.currentRow=", this.currentRow);
                console.log("column=", column);
                this.currentRow = document.getElementById('nodeTable').getElementsByClassName("current-row")[0];
                console.log("this.currentRow2=", this.currentRow);
                this.currentRow = document.getElementById('nodeTable').getElementsByClassName("current-row")[0];
                console.log("this.currentRow3=", this.currentRow);
            },
            filtrateCreater() {
                var dataPost = {
                    "creater": this.filtrate,
                };
                this.$http.post(this.url+'/getCreater', dataPost).then(
                    function (data) {
                        var responData = data.status;
                        if (responData === 200 || responData === '200') {
                            this.flowData = data.body;
                        } else {
                            this.$message({
                                showClose: true,
                                message: '很遗憾，筛选失败',
                                type: 'error'
                            });
                        }
                    }
                );

            },
            actionFlow(index, row){
                var dataPost = {
                    "flow_id": row.pk,
                };
                this.actionLoading = true;
                this.$http.post(this.url+'/actionFlow', dataPost).then(
                    function (data) {
                        var responData = data.status;
                        if (responData === 200 || responData === '200') {
                            this.actionLoading = false;
                            this.$message({
                                showClose: true,
                                message: '测试流接口执行成功，结果请查收邮件',
                                type: 'success'
                            });
                        } else {
                            this.actionLoading = false;
                            this.$message({
                                showClose: true,
                                message: '很遗憾，接口执行失败',
                                type: 'error'
                            });
                        }
                    }
                );



            }
        }
    })
</script>
</body>

</html>